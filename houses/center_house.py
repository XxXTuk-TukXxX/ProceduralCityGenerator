# houses/center_house.py
# ─────────────────────────────────────────────────────────────────────
from __future__ import annotations
from typing import List, Tuple
import numpy as np
from shapely.geometry import Polygon
import matplotlib.pyplot as plt


Coord = Tuple[float, float]
Ring  = List[Coord]


class CenterHouse:
    """
    Minimal container that remembers the *interior outline ring* produced by
    CenterRegion (or any ring you supply).

    Parameters
    ----------
    outline_ring : list[(x, y)]
        A single closed or open ring.  If it isn’t closed the constructor adds
        the first vertex to the end automatically.
    """

    # ───────── construction ─────────────────────────────────────────
    def __init__(self, outline_ring: Ring) -> None:
        # 1. normalise every vertex to a plain (float, float) tuple
        ring = [tuple(np.asarray(pt, float)) for pt in outline_ring]

        # 2. close the ring if it isn’t already
        if ring[0] != ring[-1]:
            ring.append(ring[0])

        self.outline_ring: Ring    = ring
        self.outline_poly: Polygon = Polygon(ring).buffer(0)   # cached shapely

        


# ─── quick demo ───────────────────────────────────────────────────────────────
if __name__ == "__main__":

    # Example outline ring – replace with CenterRegion.rings()[0] in real use
    demo_ring = [(20.42317684318659, 11.555137143927098), (21.319407537283134, 17.138137602519077), (21.330117211678587, 17.23451816641678), (21.331441136983226, 17.331482889098194), (21.32336686312235, 17.428119923016435), (21.30597031984245, 17.52352050218033), (21.279415102674733, 17.616787488108205), (21.243950934497384, 17.707043806437643), (19.91728610536524, 20.65482289441149), (27.21250603214087, 23.93807832461728), 
(27.299911885015412, 23.982696297889046), (27.382523528670514, 24.035666695171006), (27.45954536781766, 24.096479382580767), (27.53023564004144, 24.16454870069498), (27.59391355937711, 24.23921910476973), (27.64996587265157, 24.31977147799478), (27.697852765446683, 24.40543005698157), (27.73711306080719, 24.495369902788706), (27.767368660626904, 24.588724845534955), (27.788328186940173, 24.684595826088664), (27.79978978805096, 24.78205955449869), (27.801643082475014, 24.880177401781356), (27.793870221973922, 24.978004439430652), (27.776546063443384, 25.07459853959632), (27.7498374480004, 25.169029448290058), (27.714001594212096, 25.260387744239956), (25.65411812988361, 29.837339862419473), (26.990274601783188, 33.677847035704396), (27.076184391833557, 33.67860294957993), (27.173758778481524, 33.689080817964296), 
(27.2698363070922, 33.70907219489713), (27.363491698543747, 33.73838455249019), (27.453823000219245, 33.77673559671609), (27.539960272303446, 33.8237559860541), (27.621073965778756, 33.87899288845096), (27.696382911435748, 33.941914342341015), (27.765161842959696, 34.01191437972694), (27.82674838164163, 34.08831886198279), (27.880549415447415, 34.17039197217751), (27.92604681101087, 34.2573433013942), (27.962802403541307, 34.348335460800065), (31.149561223153196, 43.508018749127025), (31.177221036201903, 43.602175434485616), (31.19551869064882, 43.698589865445655), (31.20427797007912, 43.796333518331494), (31.203414517843566, 43.89446506833374), (31.19293664945921, 43.9920394549817), (31.17294527252637, 44.08811698359238), (31.14363291493331, 44.18177237504393), (31.10528187070742, 44.272103676719425), (31.0582614813694, 44.358240948803626), (31.003024578972543, 44.439354642278936), (30.94010312508249, 44.51466358793593), (30.870103087696567, 44.58344251945987), (30.793698605440714, 44.64502905814181), (30.711625495245993, 44.69883009194759), (30.624674166029305, 44.74432748751105), (30.53368200662344, 44.78108308004149), (22.318470492018587, 47.63924934246103), (25.27580350674977, 56.139495305960025), (25.304570535373728, 56.238291793542835), (25.323032631368296, 56.33952142806771), (25.330994312745943, 56.44211236102083), (25.328371278932128, 56.54497833006874), (25.31519130336402, 56.64703016071658), (25.29159393941738, 56.7471872988013), (25.257829042775228, 56.84438925171016), (25.214254125883944, 56.93760681718186), (25.161330572508547, 57.02585298079634), (25.099618752468583, 57.108193366767665), (19.30723476026316, 64.06050577104196), (27.186870418156033, 71.8525773086141), (30.265862245417217, 68.73898502760595), (30.338206382914212, 68.67267611097009), (30.416701574002495, 68.61377745536896), (30.500591867082047, 68.56285628705328), (30.589069352771418, 68.52040300471029), (30.681281944516698, 68.48682645665626), 
(30.77634158465085, 68.46245000340376), (30.873332796874507, 68.44750840352314), (30.971321502793156, 68.44214555278917), (31.069364017602727, 68.44641309838605), (31.166516138290113, 68.46026994151677), (31.261842236824343, 68.48358263320709), (31.35442427076599, 68.51612665949203), (31.443370624517705, 68.55758860360807), (31.527824696069835, 68.60756916436796), (31.606973146546043, 68.66558700164946), (31.6800537331013, 68.73108337196373), (34.22322137919627, 71.24598952889512), (36.98190209242189, 68.4563078875165), (34.7081404406825, 66.20781389376255), (34.64183152404664, 66.13546975626555), (34.5829328684455, 66.05697456517727), (34.532011700129836, 65.97308427209772), (34.48955841778684, 65.88460678640836), (34.45598186973281, 65.79239419466307), (34.431605416480316, 65.69733455452891), (34.4166638165997, 65.60034334230527), (34.41130096586573, 65.50235463638661), (34.41556851146259, 65.40431212157704), (34.42942535459332, 65.30716000088965), (34.45273804628365, 65.21183390235542), (34.48528207256857, 65.11925186841378), (34.52674401668461, 65.03030551466206), (34.57672457744451, 64.94585144310993), (34.634742414726, 64.86670299263372), (34.700238785040284, 64.79362240607847), (41.73168794524963, 57.68315668944701), (41.80403208274663, 57.61684777281115), (41.88252727383491, 57.557949117210015), (41.966417566914465, 57.50702794889435), (42.05489505260383, 57.46457466655135), (42.14710764434911, 57.43099811849732), (42.242167284483266, 57.40662166524483), (42.33915849670692, 57.39168006536421), (42.43714720262557, 57.38631721463024), (42.53518971743514, 57.3905847602271), (42.63234183812253, 57.40444160335783), (42.72766793665676, 57.42775429504816), (42.820249970598404, 57.460298321333084), (42.90919632435012, 57.50176026544912), (42.99365039590225, 57.55174082620902), (43.072798846378454, 57.60975866349051), (43.14587943293371, 57.675255033804795), (49.545298577902024, 64.0035592779932), (55.621487164362975, 57.85908896363604), (49.93311459105781, 52.23392963546857), (49.86680567442195, 52.16158549797157), (49.80790701882081, 52.08309030688329), (49.756985850505146, 51.99920001380374), (49.71453256816215, 51.91072252811437), (49.68095602010812, 51.81850993636909), (49.656579566855626, 51.72345029623494), (49.64163796697501, 51.62645908401128), (49.63627511624104, 51.528470378092635), (49.6405426618379, 51.430427863283064), (49.65439950496863, 51.333275742595674), (49.67771219665896, 51.237949644061445), (49.71025622294388, 51.1453676101198), (49.75171816705992, 51.05642125636808), (49.80169872781982, 50.97196718481595), 
(49.85971656510131, 50.89281873433975), (49.925212935415594, 50.81973814778449), (61.87867650777148, 38.731946429511005), (58.05200426812212, 34.94779889569433), (57.98569535148626, 34.875454758197336), (57.92679669588512, 34.796959567109056), (57.875875527569455, 34.7130692740295), (57.83342224522646, 34.62459178834013), (57.79984569717243, 34.53237919659485), (57.775469243919936, 34.4373195564607), (57.76052764403932, 34.340328344237044), (57.75516479330535, 34.2423396383184), (57.75943233890221, 34.14429712350883), (57.77328918203294, 34.04714500282144), (57.79660187372327, 33.95181890428721), (57.82914590000819, 33.85923687034556), (57.87060784412423, 33.770290516593846), (57.92058840488413, 33.685836445041716), (57.97860624216562, 33.60668799456551), (58.044102612479904, 33.533607408010255), (68.22011253035902, 23.243243643078056), (68.19795597776587, 23.18239423308312), (68.17357952451337, 23.087334592948967), (68.15863792463276, 22.99034338072531), (68.15327507389878, 22.89235467480666), (68.15754261949566, 
22.79431215999709), (68.17139946262638, 22.697160039309704), (68.1947121543167, 22.601833940775474), (68.22725618060164, 22.50925190683383), (68.26871812471768, 22.420305553082112), (68.31869868547757, 22.335851481529982), (68.37671652275907, 22.256703031053775), (68.44221289307335, 22.183622444498518), (79.67065659433025, 10.82899807478512), (79.74300073182725, 10.762689158149257), (79.82149592291553, 10.70379050254813), (79.90538621599508, 10.652869334232458), (79.99386370168445, 10.610416051889464), (80.08607629342973, 10.576839503835435), (80.1811359335639, 10.55246305058294), (80.27812714578754, 10.537521450702325), (80.37611585170619, 10.53215859996835), (80.47415836651577, 10.536426145565216), (80.57131048720315, 10.550282988695946), (80.66663658573738, 10.573595680386271), (80.75921861967902, 10.606139706671199), (80.84816497343074, 10.647601650787234), (80.93261904498287, 10.697582211547132), (81.01176749545908, 10.755600048828622), (81.08484808201433, 10.821096419142908), (84.61796016343314, 14.314946044169561), (90.56491099691374, 8.301165803924198), (74.41696079363778, -9.055890418201706), (67.48201880158881, -2.604041872164196), (67.40335805805367, -2.538059506738423), (67.31834640792489, -2.480490379047757), (67.2278799747439, -2.4319413359244204), (67.13291238193007, -2.3929241418194094), (67.03444470045972, -2.363850084198673), (66.93351489639161, -2.345025638085802), (66.83118688947465, -2.3366492354520663), (66.72853933817275, -2.338809173508273), (66.6266542693264, -2.351482683947522), (38.29917264482282, -7.363306323412609), (37.602297746507205, -3.4244784043359697), (37.580479692076736, -3.3287991528941063), (37.549388490926624, -3.235719166502565), (37.50932356832013, -3.1461348563129925), (37.46067077136365, -3.0609089682042794), (37.403898653088234, -2.9808622740681225), (37.33955396002764, -2.906765667327027), (37.26825636675044, -2.839332738809235), (37.19069250805513, -2.7792129044789613), (37.10760936630165, -2.726985151205651), (37.01980707756296, -2.68315246080392), (36.92813122587722, -2.6481369660437233), (36.833464699811294, -2.622275885281018), (36.736719189761175, -2.6058182748606535), (36.63882640787512, -2.598922630567623), (36.54072911515634, -2.601655361226011), (36.44337204215914, -2.6139901491457143), (35.509679617680945, -2.779183152428487), (37.78771379163368, -1.3299221070587863), (37.86782890827004, -1.2732465855177586), (37.94200307617398, -1.2089913174740823), (38.00952195756085, -1.1377751162845187), (38.06973530869332, -1.0602838328972592), (38.12206324208401, -0.9772637507323678), (38.16600181112902, -0.8895143985644856), (38.201127863389175, -0.7978808506236643), (38.227103115779364, -0.7032455880685671), (38.24367741241955, -0.6065200002104961), (38.25069113377265, -0.5086356073361097), (38.24807673386795, -0.41053508965784), (38.2358593908057, -0.3131632087881271), (38.21415676427828, -0.2174577091686306), (38.183177862443, -0.12434028707863426), (38.14322102905934, -0.034707714196025585), (38.094671070275396, 0.05057679880418797), (33.40617989568838, 7.420224354093607), (33.34950437414736, 7.500339470729975), (33.28524910610368, 7.574513638633913), (33.21403290491411, 7.642032520020781), (33.13654162152685, 7.702245871153247), (33.05352153936197, 7.7545738045439405), (32.965772187194084, 7.798512373588951), (32.87413863925326, 7.83363842584911), (32.77950337669816, 7.859613678239299), (32.68277778884009, 7.876187974879483), (32.5848933959657, 7.883201696232583), (32.48679287828743, 7.880587296327882), (32.38942099741772, 7.868369953265635), (32.293715497798225, 7.846667326738213), (32.20059807570823, 7.8156884249029375), (32.110965502825614, 7.775731591519271), (32.0256809898254, 7.727181632735328), (25.499761526788337, 3.5754612717589422), (20.42317684318659, 11.555137143927098)]  

    # Initialise CenterHouse
    ch = CenterHouse(demo_ring)

    # Plot the ring outline
    xs, ys = zip(*ch.outline_ring)
    fig, ax = plt.subplots(figsize=(6, 6))
    ax.plot(xs, ys, color="lime", linewidth=2.5, label="CenterHouse outline")
    ax.set_aspect("equal", "box")
    ax.set_title("Demo – CenterHouse stores & plots the outline ring")
    ax.legend()
    plt.show()
